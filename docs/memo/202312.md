# 12/1

## Storybook

SB の RSC 対応 issue で、直近数日に動きがあった。

https://github.com/storybookjs/storybook/issues/21540#issuecomment-1833840698

以下のような Decorator で Async Component を含む Story をラップすればよい」という内容。

```jsx
import { Decorator } from "@storybook/react";
import { Suspense } from "react";

export const WithSuspense: Decorator = (Story) => {
  return (
    <Suspense>
      <Story />
    </Suspense>
  );
};
```

試しに手元の `@storybook/react` の v7.5.3 で試したところ、ちゃんと描画される。

```tsx
import { Suspense } from 'react'
import type { Meta, StoryObj } from '@storybook/react'

async function MyAsyncComponent() {
  const res = await fetch('/iframe.html')
  return (
    <div>
      <p>Fetch status: {res.status}</p>
    </div>
  )
}

const meta = {
  title: 'components/MyAsyncComponent',
  component: MyAsyncComponent,
  args: {},
  decorators: [
    (Story) => (
      <Suspense fallback={<div>Load story...</div>}>
        <Story />
      </Suspense>
    ),
  ],
} satisfies Meta

export default meta

type Story = StoryObj<typeof MyAsyncComponent>

export const Default = {} satisfies Story
```

「非同期コンポーネントが許容されるのは SC のみ」と理解していたので、なぜにこれで動くのかさっぱりわからん..
というよりも、CC でも非同期コンポーネントが許容されるのであれば、 `use()` を持ち出す必要も無いことになるし。

https://react.dev/blog/2023/03/22/react-labs-what-we-have-been-working-on-march-2023#:~:text=we%20introduced%20async%20/%20await%20as%20the%20primary%20way%20to%20do%20data%20fetching%20from%20Server%20Components

---

# 12/6

## Storybook

先日に書いた Suspense Decorator の件があれよあれよという間に時期リリース向けのブランチに取り込まれていた。

> 以下のような Decorator で Async Component を含む Story をラップすればよい」という内容。

https://github.com/storybookjs/storybook/pull/25091

どうにもモヤつくので、以前書いた RSC のテストの記事に追記. https://quramy.medium.com/react-server-component-%E3%81%AE%E3%83%86%E3%82%B9%E3%83%88%E3%81%A8-container-presentation-separation-7da455d66576

`experimentalNextRSC` フラグは `@storybook/react` v8 で入りそうだが、これとは別に v8 で Storybook 側の Next.js サポートの下限が v13.5 まで上がっているので注意。

https://github.com/storybookjs/storybook/pull/25017

## StyleX

ついに公開された

https://stylexjs.com/

## CSS

CSS Text Module level 4 における `word-break: auto-phrase` や `text-autospace` の解説:

https://developer.chrome.com/blog/css-i18n-features?hl=ja

Chrome は BudouX というテキスト処理系を利用することで実現するとのこと。

BudouX については https://b-risk.jp/blog/2021/12/budoux/ もわかりやすかった。

---

# 12/7

## Prisma

https://github.com/prisma/prisma/releases/tag/5.7.0 にて `relationJoins` Preview Feature が利用可能に。

`include` などで Relation 跨いだ Model をクエリするときに、PostgresDB や CockroachDB ではネイティブ SQL の `JOIN` が利用されるようになる。

また、 v5.7.0 では `nativeDistinct` という Feature Flag も追加されている。名称そのまま。

## GraphQL

Semantic Non Null 周りをアドカレの記事にした。

https://quramy.medium.com/graphql-%E3%81%AE-semantic-non-null-type-rfc-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6-49fb18a06afb
