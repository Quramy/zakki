# 11/4

## Jest と Native ESM の相性問題

Node.js で Require ESM が利用可能になって以降、ESM のみを提供するライブラリが増加傾向である。
おしごとでいうと、先日リリースされた Storybook v10 もその典型。

こうなってくると、CJS 前提でしか動作しない Jest の利用が厳しくなってくる。

Jest に対する延命措置としては、以下のように swc や ts-jest に対して、ESM パッケージもトランスパイルするように指示してしまえば回避は可能。

```js
module.exports = {
  // Other Jest config options...
  transformIgnorePatterns: ["node_modules/(?!(@storybook|storybook)/)"],
};
```

Vitest も v4 でたことだし、そろそろ真面目に以降していかないとダメな時期になってしまっているのかも。。。

# 11/5

## `Set.prototype.symmetricDifference`

少し前に Set の集合演算系メソッドを調べ直したが、ちょうど利用する機会があったので使ってみた。

2種類の JSON Object A, B について、すべての Property が一致しているか確認するようなユーティリティをさっと書く機会があり、そこで利用。

この手のユーティリティは何度も書いているが、 `Object.entries` ループで深さ優先探索を回す前段で、そもそも A, B の keys 集合が一致しているかを確認する必要がある。
ここで、以下のように対称差が空集合かどうかをみれば、A / B の keys 集合の一致を簡潔に確認できる。

```js
const keysA = new Set(Object.keys(objA));
const keysB = new Set(Object.keys(objB));
const symmetricDiff = keysA.symmetricDifference(keysB);

if (symmetricDiff.size > 0) {
  return false;
}
```
