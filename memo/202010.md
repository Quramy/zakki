# 10/1

## ts-graphql-plugin

https://github.com/Quramy/ts-graphql-plugin/issues/147

クエリが引数を許容しないのであれば、そもそも variable 用の type を出力しない方がいいかもな。

## Others

変に Component の内側で impedance mismatch を吸収しようとすると、碌なものにならない。可読性やテスタビリティ的にも良いことない、というのを身を持って学ぶ。
理屈としては分かってるんだけど、ついいじる箇所を最小限にしたくなって、、、という囁きに騙されそうになってしまう。

---

# 10/2

## Semantic な form

aria-invalid のような属性や、HTML 標準の `required` 属性など、form をセマンティックに扱うための仕組みを使いこなせていなかったな、と反省。

これらの知識が最初からあったして（実際に `required` は知っていたし）、最初からそれを組み込めたのか、というとやはり厳しいだろうし、いきなり 100 点が取れるわけでもないと思う。

下記のようなアプリケーションコードを書いていたとして、

```tsx
<Form onSubmit={handleSubmit}>
  <label>
    PostalCode
    <Input
      name="posal_code"
      onChange={handleChangePostalCode}
      value={postalCode}
    />
  </label>
</Form>
```

ある日、 `input[name="posal_code"]` に対して、 `autocomplete="postal-code` を一気に付与したい、というようなケースがあったことを考える。
ここでの `autocomplete` 属性は一例であって、何某かの `aria-` かもしれないし、別の属性でも構わない（要するに SPA 開発者が忘れがちな属性、ってとこがポイント）。

愚直な書き方であれば、郵便番号を扱っているすべての箇所に、下記を追加して回ることになる：

```tsx
<Input
  name="posal_code"
  onChange={handleChangePostalCode}
  value={postalCode}
  autocomplete="postal-code"
/>
```

form に関する知識、すなわち「`postalCode` という値は郵便番号である」という情報と、 「input タグに`autocomplete="postal-code"`を付与したい」という欲求は密接に関連していると思うんだけど、この関連性と「状態は State management, DOM は JSX」という分離の相性が余り良くない。

「form に関する情報 -> HTML 属性の付与」という機構を最初から備えておければ、後からの属性追加についても、アプリケーション全体への影響は最小限にして進められるんじゃないか、という期待。Headless UI Component のパターンでそれができる？

よく出来た form ライブラリの設計を読み解いてみたい

https://www.merrickchristensen.com/articles/headless-user-interface-components/

https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#attr-fe-autocomplete

## Others

Puppeteer に出した PR にレスポンスがつかなくて悲しい。。。 :sob:

やることが思い浮かばないので、 https://github.com/reg-viz/img-diff-js の TS 化に着手。
合わせて AVA -> Jest, GH Actions の導入などもやる。reg-suit でもやった作業だし、今回はそもそものソースコードが少ないので余裕で終わった。renovate も突っ込んだ。

PR のコメント欄にて。"wdyt?" ってなんだろう？って思ったけど、 "What Do You Think (WDYT)" か。小文字で書かれるとより分からない！

---

# 10/3

---

# 10/4

https://tsconf.io/index オンライン開催か。。。 \$39 ね、、、悩まし。

---

# 10/5

## Coverage 関連

webpack で bundle した sourcemap の場合にどうなるのか、というのをやってみる。
istanbul の出力はでるものの、report が生成されない。 `CoverageMapData` の path の値として、webpack モジュール内での module ID 的なのになっていて、src ファイルとの紐付けが出来ないのが問題っぽい。
src のディレクトリを指定させる、というやりかたと、sourcemap の `sourcesContent` から復元するのとどっちがいいのかしら。 https://sourcemaps.info/spec.html
Storycap 文脈だと、delpoy されてるサーバーに対して、っていうパターンがあるし、sourcemap のコンテンツから復帰させる方がよさそうではある。

https://github.com/Quramy/puppeteer-coverage-study に実装してみた. convert-source-map に同梱されてる SourceMappingURL 取得する正規表現が先頭一致でコメント返してくるのにハメられる。
手元の Storybbok でも coverage 取れたし、PoC としては一通り完了。後は Puppeteer に PR が merge されるのを待つばかり。。。

## Others

vim-twiggy で、 `fix/1234` みたいな branch 名だとうまく pull できないなーと思ってたらバグだったので PR 作成。 https://github.com/sodapopcan/vim-twiggy/pull/36

TS Conf 申し込んだ。

headless UI 、これを見たら理解を深められるかしら？ https://github.com/tailwindlabs/headlessui

TypeScript で使えそうな ORM いろいろ。 Prisma が書いた blog なので、そこは念頭に入れて読んだほうがよさげ。 とはいえ Bookshelf.js とか MicroORM とか、初見のものも多いなぁ。 https://www.prisma.io/dataguide/database-tools/evaluating-type-safety-in-the-top-8-typescript-orms

---

# 10/6

## Coverage 関連

「Puppeteer の Coverage のとり方分かったら、後は Storycrawler に突っ込めばとりあえず SB の Coverage 取れるじゃん！」というのに気づく。
ありものを組み合わせるだけだったので一瞬で実装できた https://github.com/Quramy/storycov

## form もやつき

https://react-hook-form.com/ の getting started 辺りを読み出してみる

### Controlled v.s. Uncontrolled

react-hook-form が ref 使う(i.e. uncontrolled)であり、rerender 観点で performance メリットがあるとのこと。 https://react-hook-form.com/faqs#PerformanceofReactHookForm

- https://reactjs.org/docs/forms.html#controlled-components
- https://reactjs.org/docs/uncontrolled-components.html

これはまぁわかる。

"How to create an accessible input error and message?" ( https://react-hook-form.com/faqs#Howtocreateanaccessibleinputerrorandmessage ) の方だけど、「uncontrolled だから accessible な form が作りやすい」ってどういう理屈だろう？ controlled だろうと uncontrolled だろうと、あまり関係無い気がするんだけど。。。「hooks 経由で error オブジェクトが取れるから、それで `aria-invalid` を設定すればよい」と言っている？

## Others

Renovate 入れるようになるとリリースノート見るようになるなー、と思った（ typescript-eslint の rule 等眺めるので。あと Renovate の更新通知、 `@types/node` とかだと、複数の repository に片っ端から通知くるので、こういうのは GitHub の notifications から回って merge していくと効率的だ。

https://github.com/matteobruni/tsparticles 粒子描画系のライブラリ。ts 対応、各 UI(React, Angular, Svelte, etc...)対応もしている。使う機会あるか？ってのはあるけど。

新しく作った GitHub の repository に、ターミナルから `git push origin master` ってやって通らなくて、twiggy からだと push できるの何でだ！？ってなってたけど、よくよく考えたら not master but main じゃん。
