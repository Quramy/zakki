# 10/1

## ts-graphql-plugin

https://github.com/Quramy/ts-graphql-plugin/issues/147

クエリが引数を許容しないのであれば、そもそも variable 用の type を出力しない方がいいかもな。

## Others

変に Component の内側で impedance mismatch を吸収しようとすると、碌なものにならない。可読性やテスタビリティ的にも良いことない、というのを身を持って学ぶ。
理屈としては分かってるんだけど、ついいじる箇所を最小限にしたくなって、、、という囁きに騙されそうになってしまう。

---

# 10/2

## Semantic な form

aria-invalid のような属性や、HTML 標準の `required` 属性など、form をセマンティックに扱うための仕組みを使いこなせていなかったな、と反省。

これらの知識が最初からあったして（実際に `required` は知っていたし）、最初からそれを組み込めたのか、というとやはり厳しいだろうし、いきなり 100 点が取れるわけでもないと思う。

下記のようなアプリケーションコードを書いていたとして、

```tsx
<Form onSubmit={handleSubmit}>
  <label>
    PostalCode
    <Input
      name="posal_code"
      onChange={handleChangePostalCode}
      value={postalCode}
    />
  </label>
</Form>
```

ある日、 `input[name="posal_code"]` に対して、 `autocomplete="postal-code` を一気に付与したい、というようなケースがあったことを考える。
ここでの `autocomplete` 属性は一例であって、何某かの `aria-` かもしれないし、別の属性でも構わない（要するに SPA 開発者が忘れがちな属性、ってとこがポイント）。

愚直な書き方であれば、郵便番号を扱っているすべての箇所に、下記を追加して回ることになる：

```tsx
<Input
  name="posal_code"
  onChange={handleChangePostalCode}
  value={postalCode}
  autocomplete="postal-code"
/>
```

form に関する知識、すなわち「`postalCode` という値は郵便番号である」という情報と、 「input タグに`autocomplete="postal-code"`を付与したい」という欲求は密接に関連していると思うんだけど、この関連性と「状態は State management, DOM は JSX」という分離の相性が余り良くない。

「form に関する情報 -> HTML 属性の付与」という機構を最初から備えておければ、後からの属性追加についても、アプリケーション全体への影響は最小限にして進められるんじゃないか、という期待。Headless UI Component のパターンでそれができる？

よく出来た form ライブラリの設計を読み解いてみたい

https://www.merrickchristensen.com/articles/headless-user-interface-components/

https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#attr-fe-autocomplete

## Others

Puppeteer に出した PR にレスポンスがつかなくて悲しい。。。 :sob:

やることが思い浮かばないので、 https://github.com/reg-viz/img-diff-js の TS 化に着手。
合わせて AVA -> Jest, GH Actions の導入などもやる。reg-suit でもやった作業だし、今回はそもそものソースコードが少ないので余裕で終わった。renovate も突っ込んだ。

PR のコメント欄にて。"wdyt?" ってなんだろう？って思ったけど、 "What Do You Think (WDYT)" か。小文字で書かれるとより分からない！

---

# 10/3

---

# 10/4

https://tsconf.io/index オンライン開催か。。。 \$39 ね、、、悩まし。

---

# 10/5

## Coverage 関連

webpack で bundle した sourcemap の場合にどうなるのか、というのをやってみる。
istanbul の出力はでるものの、report が生成されない。 `CoverageMapData` の path の値として、webpack モジュール内での module ID 的なのになっていて、src ファイルとの紐付けが出来ないのが問題っぽい。
src のディレクトリを指定させる、というやりかたと、sourcemap の `sourcesContent` から復元するのとどっちがいいのかしら。 https://sourcemaps.info/spec.html
Storycap 文脈だと、delpoy されてるサーバーに対して、っていうパターンがあるし、sourcemap のコンテンツから復帰させる方がよさそうではある。

https://github.com/Quramy/puppeteer-coverage-study に実装してみた. convert-source-map に同梱されてる SourceMappingURL 取得する正規表現が先頭一致でコメント返してくるのにハメられる。
手元の Storybbok でも coverage 取れたし、PoC としては一通り完了。後は Puppeteer に PR が merge されるのを待つばかり。。。

## Others

vim-twiggy で、 `fix/1234` みたいな branch 名だとうまく pull できないなーと思ってたらバグだったので PR 作成。 https://github.com/sodapopcan/vim-twiggy/pull/36

TS Conf 申し込んだ。

headless UI 、これを見たら理解を深められるかしら？ https://github.com/tailwindlabs/headlessui

TypeScript で使えそうな ORM いろいろ。 Prisma が書いた blog なので、そこは念頭に入れて読んだほうがよさげ。 とはいえ Bookshelf.js とか MicroORM とか、初見のものも多いなぁ。 https://www.prisma.io/dataguide/database-tools/evaluating-type-safety-in-the-top-8-typescript-orms

---

# 10/6

## Coverage 関連

「Puppeteer の Coverage のとり方分かったら、後は Storycrawler に突っ込めばとりあえず SB の Coverage 取れるじゃん！」というのに気づく。
ありものを組み合わせるだけだったので一瞬で実装できた https://github.com/Quramy/storycov

## form もやつき

https://react-hook-form.com/ の getting started 辺りを読み出してみる

### Controlled v.s. Uncontrolled

react-hook-form が ref 使う(i.e. uncontrolled)であり、rerender 観点で performance メリットがあるとのこと。 https://react-hook-form.com/faqs#PerformanceofReactHookForm

- https://reactjs.org/docs/forms.html#controlled-components
- https://reactjs.org/docs/uncontrolled-components.html

これはまぁわかる。

"How to create an accessible input error and message?" ( https://react-hook-form.com/faqs#Howtocreateanaccessibleinputerrorandmessage ) の方だけど、「uncontrolled だから accessible な form が作りやすい」ってどういう理屈だろう？ controlled だろうと uncontrolled だろうと、あまり関係無い気がするんだけど。。。「hooks 経由で error オブジェクトが取れるから、それで `aria-invalid` を設定すればよい」と言っている？

## Others

Renovate 入れるようになるとリリースノート見るようになるなー、と思った（ typescript-eslint の rule 等眺めるので。あと Renovate の更新通知、 `@types/node` とかだと、複数の repository に片っ端から通知くるので、こういうのは GitHub の notifications から回って merge していくと効率的だ。

https://github.com/matteobruni/tsparticles 粒子描画系のライブラリ。ts 対応、各 UI(React, Angular, Svelte, etc...)対応もしている。使う機会あるか？ってのはあるけど。

新しく作った GitHub の repository に、ターミナルから `git push origin master` ってやって通らなくて、twiggy からだと push できるの何でだ！？ってなってたけど、よくよく考えたら not master but main じゃん。

---

# 10/7

## 生タグと CSS

`:first-of-type` って、少なくとも Component のトップレベルで使っていいセレクタじゃないと思った。

```tsx
/* components/CompA.tsx */
export const CompA = styled.div`
  &:not(:first-op-type) {
    margin-top: 16px;
  }
`

/* components/CompB.tsx */
export const CompB = styled.div`
  &:not(:first-op-type) {
    margin-top: 16px;
  }
`

/+ components/App.tsx */
const App = () => (
  <div>
    <CompA />
    <CompB />
  </div>
)
```

みたいな感じになってるとして、 `CompA` `CompB` に margin が付与されるかは、お互いの内部実装(=div タグであること)と結合してしまっていて、後からタグを編集すると CSS が壊れる

```
/* components/CompB.tsx */
export const CompB = styled.section`
  &:not(:first-op-type) {
    margin-top: 16px;
  }
`
```

ここまで書いて思ったけど、「自分が他の要素とどういう間隔で配置されるか」を自分で制御するのって間違ってるよな。。。

じゃぁ毎回、配置側で `styled(CompA)` みたいなことすんの？っていうのはバカらしい（emotion に insert される style タグもその分増えるし）。

Utility First CSS を持っておけば十分と思う。
以下のようなのを用意しておいて、

```css
/* util.css */
.mt-1 {
  margin-top: 8px;
}
.mt-2 {
  margin-top: 16px;
}
```

素直に class として使えばいい。

```tsx
const App = () => (
  <div>
    <CompA />
    <CompB className="mt-2" />
  </div>
);
```

emotion と util class が混在するのどうなの？という反論もありそうだけど、既存の CSS を utility で拡張するパターンも言及されている。

https://blog.usejournal.com/utility-first-css-ridiculously-fast-front-end-development-for-almost-every-design-503130d8fefc

> But even when you use other frameworks like Foundation or custom CSS, you can extend them with your own utility classes.

## 型パズル

ふと Union to Intersection のことを思い出した。 type-dungeon に追加するか。
理屈は https://qiita.com/suin/items/93eb9c328ee404fdfabc#comment-5218b3e9d13d93dfc98f がわかりやすい。こういう解説を書かせたら流石、という感じ。

## 英語

https://github.com/puppeteer/puppeteer/pull/6454 の件にて。

LGTM くれたけど merge してくれない、、、っていう状況が初めてだったので、英語でなんて書けばいいんだろ？ってなったんだけど、 https://www.englishforengineers.jp/post/122255688100/%E6%8A%95%E7%A8%BF%E3%81%8A%E9%A1%8C%E3%81%93%E3%82%8C%E3%83%9E%E3%83%BC%E3%82%B8%E3%81%97%E3%81%A6%E3%81%BB%E3%81%97%E3%81%84%E3%82%93%E3%81%A0%E3%81%91%E3%81%A9 に良いアドバイスが。

> 文章としては同等だったり、ニュアンスの差が云々という分析はできるとおもう。でもあくまで「マージしてほしい！」という実用性から考えるとこういう場合は「丁寧な英語を書く」より「何をして欲しいかはっきりわかる英語を書く」を主眼にしたほうがいいのではないだろうか、と思います。なので”Can you please merge this?”推し

確かに、「失礼にならないかな。。。」って考えちゃうけど、俺は「merge してほしい！」って本心では思ってるわけだし、今回は approve ももらってるわけだから、変に婉曲した表現しても仕方ないもんな。

## Others

https://github.com/Quramy/ts-graphql-plugin/issues/117 で「Template Literal Type 使わないの？」って無邪気に聞かれたけど、まぁ絶対に使わない。遊びならともかく、自動生成コード排除する目的だけのために型だけで再帰下降パーサー用意するとかどう考えてもおかしいだろ。

HTML の role 属性眺める: https://developer.mozilla.org/ja/docs/Web/Accessibility/ARIA/ARIA_Techniques
a11y 周り、何からやっていけばいいのかわからん、ってなるな。。。

この雑記帳、10 月の 1 週分が溜まったわけだけど、200 行 over か。1 ヶ月分貯めることを考えてたけど、1000 行とかになっちゃうのもちょっとやだな。。。

---

10/8

## Coverage 関連

ふと https://github.com/istanbuljs/nyc/blob/master/docs/setup-codecov.md や https://docs.codecov.io/docs/supported-report-formats#exhaustive-acceptable-report-formats を読んで、codecov に送信している report ファイルのフォーマットを別のものに変えたら、ちゃんとした結果に変わるかもしれない、と思い ts-graphql-plugin で試す。

今まで istanbul の json を送ってたけど、よくよく読んでみたら istanbul の json 形式に対応してるとはどこにも書いてないし、nyc の記載みても `--report lcov` ってなってた。

結果見ようと思ったらちょうどたまたま codecov が落ちてて運が悪い。

再 push したら codecov の画面から見れるようになったけど、やはり違う結果になってしまうので close

## Others

Safari って `<img src="hoge.pdf" />` 表示できるのか。。。 PDF のインラインプレビューに使える？って一瞬思ったけど、複数ページだめだし、まぁ止めとけって感じだ。

autocomplete 属性を眺める。 https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#autofilling-form-controls:-the-autocomplete-attribute

https://github.com/boa-dev/boa Rust で書かれた JavaScript interpreter らしい。自作言語の勉強に、、、と思ったけど、どうコード読んだらいいのかわからん。。。

「実践 Rust 入門」と「Web API の設計」の物理本を購入。

[](https://dev.to/_pthomann/how-i-lost-1-year-of-life-doing-failed-crypto-startup-5hlp) を読んでいたら、"whale" というのが仮想通貨界隈で特別な意味をもつ、というのを知った。 https://en.bitcoinwiki.org/wiki/Whales
