# 11/1

## GitHub Actions

https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#setting-an-environment-variable

```yaml
steps:
  - name: Set the value
    id: step_one
    run: |
      echo "action_state=yellow" >> $GITHUB_ENV
  - name: Use the value
    id: step_two
    run: |
      echo "${{ env.action_state }}" # This will output 'yellow'
```

上記のように、 step 間で変数の受け渡しができる。

これを使うと、 `set-output` などは不要になる、というよりも deprecated である旨がアナウンスされている。

https://github.blog/changelog/2022-10-11-github-actions-deprecating-save-state-and-set-output-commands/

---

# 11/2

## jest-prisma

Transaction 管理そのものの機能を Environment とは別にして、任意の Environment に織り込めるように切り出す。

モチベとしては、先週に少し宣伝してもらえたことも相まって、おしごとのプロジェクトに適用してみたくなった、という流れ。

ただ、 https://github.com/facebook/jest/issues/2549 の解決が依然できていない。

https://github.com/kayahr/jest-environment-node-single-context という workaround 的な Environment に織り込みを行って Environment を組んだのだが、`instanceof Error` のような判別は一応動かせるようになっているのだけど、以下のようなコードの catch 節が空振ってしまう。

```ts
import { PrismaClientKnownRequestError } from "@prisma/client/runtime";

async function someService(data: any) {
  try {
    await prisma.someModel.create({ data });
  } catch (err) {
    if (error instanceof PrismaClientKnownRequestError) {
      return err.code;
    } else {
      throw err;
    }
  }
}
```

## npm

上記の jest-prisma の release を workflow で組もうと思ったときに気づいた、という件。

`--workspaces` が publish 系でも使えるようになっていることに今更ながら気づく。

- https://docs.npmjs.com/cli/v8/commands/npm-publish#workspace://docs.npmjs.com/cli/v8/commands/npm-publish#workspaces

```sh
$ npm version minor -ws
$ npm publish --workspace="packages/**"
```

## CSS

https://developer.mozilla.org/ja/docs/Web/CSS/attr

以下のように「該当要素の属性を参照する」ことができる CSS 関数。普段使うことはないだろうが、テクい。

```html
<span data-content="hoge" />
```

```css
span {
  content: attr(data-connt);
}
```

---

# 11/3

## Prisma

「Prisma の integration test を書く上で factoryBot 相当の Utility が欲しい」の件。

RDB が絡むと途端に腰が重くなってしまう体質そのものを改善したいというのもあり、Prisma + PostgreSQL なプロジェクトの構築から素振りしていた。

docker-compose で Pg を up するの自体は何回か書いているはずなのだけど、それでもまだ connect するまでに詰まってしまって 2 時間くらいを無駄に溶かしてしまった。

適当な Schema を組んで、jest 上で動かせるようになったところで、以前に目をつけていた https://github.com/echobind/prisma-factory をためそうと思ったのだが、 v4 系に対応しておらず `npm install` すらできずに撃沈。@seya さんの https://zenn.dev/seya/articles/5d384daafb1c24 の記事を読み込んで、自分で何か手を動かしてみるのが良さそう。

触り心地は試せなかったものの、Prisma generator plugin の作成方法という意味では prisma-factory から読み取れる知見はありそう。

jest-prisma で取り組んだ Framework managed な Transactional Testing は実装すべきコアな機能が明白であったので、あまり困らなかったのだが、factory については 例えば factoryBot にどのような機能があるのかの全体像をちゃんと把握できていないため、やはりまずはモチベーションを明確にするところから。

---

# 11/7

## Ruby

YJIT の解説動画: https://www.youtube.com/watch?v=zS3gceogbJE

Rust.Tokyo の発表資料より。

---

# 11/8

## Prisma

Release Note を眺めていたら、 "Client Extension Proposal" というものを見かける。

https://github.com/prisma/prisma/issues/15074#issuecomment-1282419200
