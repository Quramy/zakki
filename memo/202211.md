# 11/1

## GitHub Actions

https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#setting-an-environment-variable

```yaml
steps:
  - name: Set the value
    id: step_one
    run: |
      echo "action_state=yellow" >> $GITHUB_ENV
  - name: Use the value
    id: step_two
    run: |
      echo "${{ env.action_state }}" # This will output 'yellow'
```

上記のように、 step 間で変数の受け渡しができる。

これを使うと、 `set-output` などは不要になる、というよりも deprecated である旨がアナウンスされている。

https://github.blog/changelog/2022-10-11-github-actions-deprecating-save-state-and-set-output-commands/

---

# 11/2

## jest-prisma

Transaction 管理そのものの機能を Environment とは別にして、任意の Environment に織り込めるように切り出す。

モチベとしては、先週に少し宣伝してもらえたことも相まって、おしごとのプロジェクトに適用してみたくなった、という流れ。

ただ、 https://github.com/facebook/jest/issues/2549 の解決が依然できていない。

https://github.com/kayahr/jest-environment-node-single-context という workaround 的な Environment に織り込みを行って Environment を組んだのだが、`instanceof Error` のような判別は一応動かせるようになっているのだけど、以下のようなコードの catch 節が空振ってしまう。

```ts
import { PrismaClientKnownRequestError } from "@prisma/client/runtime";

async function someService(data: any) {
  try {
    await prisma.someModel.create({ data });
  } catch (err) {
    if (error instanceof PrismaClientKnownRequestError) {
      return err.code;
    } else {
      throw err;
    }
  }
}
```

## npm

上記の jest-prisma の release を workflow で組もうと思ったときに気づいた、という件。

`--workspaces` が publish 系でも使えるようになっていることに今更ながら気づく。

- https://docs.npmjs.com/cli/v8/commands/npm-publish#workspace://docs.npmjs.com/cli/v8/commands/npm-publish#workspaces

```sh
$ npm version minor -ws
$ npm publish --workspace="packages/**"
```

## CSS

https://developer.mozilla.org/ja/docs/Web/CSS/attr

以下のように「該当要素の属性を参照する」ことができる CSS 関数。普段使うことはないだろうが、テクい。

```html
<span data-content="hoge" />
```

```css
span {
  content: attr(data-connt);
}
```
