# 7/4

## reg-suit

久々にメンテ。以下の Dependencies が古かったり脆弱性抱えてたりすることを社内で指摘されて重い腰を上げる。

- cpx
- request-promise

それはそうと、S3 の SDK 周りを更新しないと辛い。

多分、デフォルトで Bucket 作ったときの Bucket 設定としてオブジェクトで ACL 書けないようにされているのか、S3 Plugin 周りがボロボロになってる。

---

# 7/5

## CSS

自分のメディアクエリを alias するヤツ、Media Queries Level 5 上は存在していることを初めてしった。

https://www.w3.org/TR/mediaqueries-5/#custom-mq

```css
@custom-media --medium (max-width: 1024px);

@media (--medium) {
  body {
    font-size: 16px;
  }
}
```

Post CSS では以下の plugin に対応している。2023/7 現在だと Stage 2

https://github.com/csstools/postcss-plugins/blob/main/plugins/postcss-custom-media/README.md

---

# 7/6

## Misc

Prettier v3 がリリースされている。

ただ、pretty-quick が動作しなくなってしまっているため、各レポジトリで利用するのはちょっと厳しいかも

---

# 7/11

## Misc

自宅での作業環境について、椅子と PC デスクを 15 年ぶり程度に刷新することにした。

---

# 7/14

## Prisma

Prisma v5 が Release された。

https://www.prisma.io/docs/guides/upgrade-guides/upgrading-versions/upgrading-to-prisma-5

`jsonProtocol` が Generally Available となるなどが大きい変更。

Breaking Change では、 https://www.prisma.io/docs/guides/upgrade-guides/upgrading-versions/upgrading-to-prisma-5#removal-of-array-shortcuts が個人的に影響が大きい。

schema 上配列型で定義している field について要素単独を与えた場合、Prisma 側で暗黙的に配列として扱う、という挙動が撤廃された。

より具体的には Prisma namespace に定義されていた以下の Type Alias を利用している箇所がただの`Array<T>` に変更された。

```ts
type Enumerabale<T> = T | Array<T>;
```

これに伴って prisma-fabbrica の出力するコードが v5 に対して Not Assignable となってしまう。

## Next.js

https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config

---

# 7/18

## prisma-fabbrica

Prisma client v5 対応として、fabbrica の v2.0.0 を release する。

これとは関係が無いが、ちょうど 100star に到達。

---

# 7/19

## CSS

ハンバーガーメニューをバツアイコンに変形させる CSS アニメーションのサンプル:

https://ics.media/entry/15130/

## Next.js

App Router の Parallel Routes と、Soft Navigation / Hard Navigation での挙動の際の話がいまいちスッキリきていない。

https://nextjs.org/docs/app/building-your-application/routing/parallel-routes#defaultjs

このドキュメントのサンプルでも Parallel Routes でモーダルを実装する例が出てくるんだけど、そこにもモーダルを閉じるときは 「`router.back()` を使え」と書いてあるし、これは Intercepting Routes 側のドキュメントにも似たようなことが書いてある。

> If a modal was initiated through client navigation, e.g. by using <Link href="/login">, you can dismiss the modal by calling router.back() or by using a Link component.

例えば EC サイトなどで、「未認証でカートに追加ボタンを押したらログインモーダルが出てから、同一ページの認証後画面に切り替わる」のような要件を実現しようと思ったときに、 `router.back()` でモーダルを閉じちゃうと、再度ブラウザフォワードしたらまた同じモーダルが表示されてしまわないか？という気もするんだけど、これどうやって防いだら良いんだろう？
