# 1/4

## reg

少し前に思いついた「wiki に画像と json 保持させてホスティングした report UI で表示する」の PoC を始める。

たまたま @bokuweb が https://github.com/bokuweb/reg-actions をやり始めていたのもきっかけ。

GitHub Raw Content から JSON を fetch するプラン自体は問題なくできそうであるが、当然 CORS になるため、Canvas から 2D Context の取得ができなくなり、x-img-diff の marker 表示が block されることに気づく。

https://github.com/Quramy/reg-gh-action-poc/pull/://github.com/Quramy/reg-gh-action-poc/pull/1

結論からすると、結構微妙かもしれない。

`https://raw.githubusercontent.com/wiki/Quramy/reg-gh-action-poc/reg-assets/8402aef54d0bebaec4cd2060e93d1650be2b2cd5/reg.json` の URL であれば、確かに CORS で fetch できるが、private repo だと絶対に使えない。

Private Repo の場合、ここに `?token=XXXXXX` が付与されることになる。 `https://github.com/Quramy/reg-gh-action-poc/wiki/reg-assets/8402aef54d0bebaec4cd2060e93d1650be2b2cd5/reg.json` とすればトークン付きの URL に redirect されるが、こっちの URL は CORS に引っかかることになる。

なので、真面目に対応しようとすると、Report UI を OAuth App なり GitHub App なりにして、ユーザーから正しく token 貰った上で GitHub API で Download URL をもらうくらいしか思いつかない。

https://docs.github.com/en/rest/reference/repos#get-repository-content
