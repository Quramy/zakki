# 11/2

## ts-graphql-plugin

https://github.com/Originate/eslint-plugin-ts-graphql

クエリに合わせた型定義を自動でやってくれる ESLint rule + auto fixer.
自分の作った OSS の上で他の人が色々やってくれるのを見るとホントに気分がいいなぁ。嬉しくなる。

## Storycap

サンプルの script 起動するための ts-node のオプションに transpileOnly 追加

## reg

久々に手元で reg-cli 回したら結構 diff 取るのに時間掛かってる。
worker thread 系の何か試せたりするだろうか？

## 英語

先週、dulicate を「ダプリケイト」って発音してる人がいて、（その場で特に指摘はしなかったんだけど）自分の記憶が疑わしくなってので撥音調べる。

deprecate と duplicate ってアクセントが全然違うのね。

## Misc

このメモも 3 ヶ月目かー。まぁそこそこに続いてるかな？

---

# 11/4

## TypeScript

https://devblogs.microsoft.com/typescript/announcing-typescript-4-1-rc/

4.1 の RC が release されたので、軽くまとめを書く。一旦このレポジトリで markdown としてまとめ書いたけど、会社の Slack に流しておしまい。

## 英語

たまーにメールで「〇〇について discussion しないかい？」ってライトなノリなやつが来ることあるけど、リアクションに困る。
自分が認知してない相手からであればほぼ 100%で無視するけど、年に 1 回程度で「あー、これは気になる」っていうのが来るんだよな。。。
（今回は "things about general GraphQL" だった。元 Meteor の中の人）

1 on 1 で call するのに踏み出せなくて、「Slack とかがいいんだけど」って返さざるを得ないのが悲しい。

## Next.js

`Cache-Control: public, max-age=0` が public dir の asset に付与されてるんだけど、だれがどこで setHeader してんのかわからん。。。

## Misc

Google で「大統領選挙」で調べたときに出てくる開票速報がリロードされなくても画面更新されてたので、「何使ってるんだろ？」って思って devtool 開いてみたら、JSONP っぽい XHR を polling している風だった。

久々過ぎて毎回忘れるシリーズ:

- Android ADV からみた Host PC の address が 10.0.0.2 であること
- Dockerfile と Docker Compose Config YAML の書き方
- envsubst コマンドの存在

---

# 11/5

## reg

PHP Conference で reg-suit の話があるみたい。もしかしたら Storycap も？

https://fortee.jp/phpcon-2020/proposal/d6d95063-67d7-416f-b480-7c12ceb69038

## Next.js

ひさびさに `pages/posts/[post_id].tsx` 的な path parametric な Component を作ろうとしたら、Next Link が CSR で Dynamic Routing されなくてドハマリする。

原因は何のことはなくて、下記のように書いてたんだけど、

```html
<Link href={`/posts/${postId}`><a>りんく</a></Link>
```

正しくはこうだったのをすっかり忘れてた。

```html
<Link href="/posts/[post_id]" as=`/posts/${postId}`><a>りんく</a></Link>
```

しかも v9.5.4 でわざわざこの書き方する必要なくなったらしい。

---

# 11/6

## Vim

vim9script というのがあるのか。。。

- https://zenn.dev/mattn/articles/9c670e5ec661becb4d88
- https://github.com/vim-jp/issues/issues/1332

ちゃんと読んでないけど、AST に parse できるように構文を変えてるらしい。

旧来の Vim script の場合、下記のような部分が、runtime semantics に頼らないと決定できないのが問題。

```vim
echo hello.world
```

- `hello` というディクショナリの `world` という値
- `hello` という文字列と `world` という文字列の結合

のどっちなのか、判断できないため、compile しようがなく、都度 interpret するしかない。

自分の.vimrc あたりから書き換えてみるか、、、と思わないでもないが、そもそも.vimrc に負債というか秘伝のタレ化していて、言語イジるよりも前にやらなきゃいけないことが色々ある気がする。
いらん plugin の install やめたりとか、NeoBundle 切るとか。

## Next.js

`next/image` の話を社内のフロントエンド共有会で聞いた。

- `render/renderToString()` のタイミングで、 `<Image>` の src/srcsets 属性が書き換わる。query string に width を付与したり、CDN 向けの URL を生成したりなど。
  - どういう src にするかは next.config で制御できる。デフォルトは next server へのリクエストになるだけ。
- ブラウザから書き換えられた src のリクエストを Next.js server が受け付けた場合、optimize 処理を行った buffer を返却する
  - optimizer は https://github.com/lovell/sharp が使われる
  - PNG -> webp のような codec の変換は現状行われない。開発者が指定した拡張子の形式がそのまま利用されるだけ
- SSG かつ default loader の場合、next server がいないので何も行われないのと一緒。
  - imgix とか cloudinary の CDN に任せないとダメ

## GraphQL

Apollo Day というイベントが 11/10 に開催されるらしいので、とりあえず申し込みだけした。

https://events097286.typeform.com/to/X9BF8MNs

JST だと 11/11 午前 0 時開始っぽい。

## Rust のお勉強

大分日が空いてしまった。

「実践 Rust 入門」の 4 章のとこから。

primitive 型の復習。

- 精度の違う数値を混合して扱うことはできない。 i32 で定義された値と u8 で定義された値を足し算する、 とかはだめ。

触ってて気になったんだけど、main.rs じゃないとこで、 `fn foo() { }` みたいなの書いても rls のチェックが効かない？ Vim の quickrun では実行できちゃうんだけど...
main.rs に `pub mod foo;` とか書けばチェック効くようになるんだけど、そういうものなのか？

関数ポインタと関数定義型が出てきた。下の 2 つは意味が違うとのこと。

```rust
let f = someFn;
let f: fn(i32) -> i32 = someFn;
```

前者の `f` は関数定義型だけど、後者は関数ポインタ。どっちも `f(100)` みたいに呼び出せる。
呼び出せる、という意味だとクロージャも似てる。
実際、クロージャを要求するところに関数ポインタを渡すこともできる（それはそうだよな、関数自体も環境に何も束縛がないクロージャとしてみなせるので）。
逆に、クロージャを関数ポインタとして扱うことも限定的にできる（これも、そのクロージャが環境束縛が無いときだけ）。
そう考えると、コールバックを受け取る関数を提供するケースでは、引数にはクロージャを構えておくのがよい、ってことになるんかな。
この辺は実際のライブラリとかをちゃんと触ってみないと肌感わからんな。。。

## TypeScript

Halloween ネタで Type | Treat ってのをやってたのを知った。

https://dev.to/typescript/the-typescript-team-presents-type-treat-1c35

## Misc

Storybook で Rendering Performance 取る Addon。試してはいない。 https://github.com/atlassian-labs/storybook-addon-performanc://github.com/atlassian-labs/storybook-addon-performance

typescript-eslint-language-service が速い！って褒めて貰えた。嬉しい。 https://github.com/Quramy/typescript-eslint-language-service/issues/32#issuecomment-719080315

---

# 11/9

## Storycap

Storybook v6 での addon の configure や parameter 指定について、Storycap の README に書いてなかったので、v6-managed の e2e 書きがてら、README も書き換える。

## Rust のお勉強

「実践 Rust 入門」の 5 章。ユーザー定義型。

他でも聞きかじったことのある内容の復習、って感じではある。

`'static str` （文字列リテラル）と、 `&str` （文字列スライス）と、`String` （文字列型）が区別されてるのはちゃんと意識して置かないとなー。
「配列とスライスと Vec の関係と似てる」という説明は得心がいった。

本とは関係がないんだけど、rls でどうにも補完が全然効かない（そのスコープで利用可能な変数は保管されるけど、例えば `String::` とタイプしても `from` とか出てこない）という件、rust-analyzer に乗り換えたら大分改善された。
利用可能なマクロも表示されるようになったし、これはかなり DX が上がった感。

https://rust-analyzer.github.io/

ありがたかったので、Open Collective で donation しておいた。

## Blog 生成

このレポジトリの markdown を HTML に吐き出す、というのに手を付け出す。

JAMStack でいいし、Gatsby.js とかでやるのが早いんだろうけど、折角ちまちま Rust やってるわけだし、ここは Rust で吐き出すようにしたい。

https://github.com/raphlinus/pulldown-cmark や glob, 標準の fs モジュールを触りだしてみる。

「`*.md` を引っ張って、html を吐く」というのはさして問題がなく書けるんだけど、メニューや記事同士のリンクのことを考えると、画面側の要件（というかデザイン）決めてからじゃないと、内部で使う struct のフィールド一つとっても決めにくい。
このまま、このファイルをただ HTML にしたとしても、H1 に日付がくるだけになってしまうけど、リンク作ること考えると、「11/9 Rust のお勉強 / Blog 生成」みたいな感じになってて欲しくて、これをやるには markdown を parse しつつ、H1 や H2 の情報をかっさらってきて struct につめる、というのも必要。

一旦 figma か何かでカンプ起こしてからプログラム書くようにした方がいいんだろうなー。
