# 10/2

## prisma-fabbrica

prisma v5.3.x から出続けていた、DMMF 周りの TypeScript エラー修正。

## dd-trace

Next.js の instrumentation.ts + dd-trace で苦戦中。

https://github.com/DataDog/dd-trace-js/issues/3457#issuecomment-1669499660 にあるように Dynamic Import で Tracer の初期化を行うも、undici にしか計装がかからない。

next plugin が動いてくれないと旨味皆無なんだが。。。

```ts
/* src/insturumentation.ts */

export async function register() {
  if (process.env.NEXT_RUNTIME === "nodejs") {
    const tracerLib = await import("dd-trace");
    const tracer = tracerLib.default;

    tracer.init({ logInjection: true });
    tracer.use("next");
  }
}
```

やっぱり traver の初期化を行うには、 `register` 関数が呼び出されるのが遅すぎる、という話なんだろうか？

Custom Server なのかなぁ。。このために Custom Server 使うの嫌だなぁ。。。
