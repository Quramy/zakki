# 6/1

## Prisma

https://www.prisma.io/day

というイベントがあるみたい。 Prisma からのメールで知る。 Conference は 6/30 ってなってるので、恐らく JST では 7/1 の午前と思われ。前日に GraphQL Tokyo の meetup あるだろうし、そのテンションで観てみるか。

## typed-css-modules

別 repo でたまたま `npm audit` したところ、 typed-css-modules 起因の推移的依存関係に Vulnerability をあるのを見つけてしまい、そういえば tcm には renovate など仕込んでなかったことを後悔する。

他の OSS と同じように、最低限の仕込みを行って Minor Update Release

- prettier + husky
- Renovate

## Renovate

前から少し気になっていた「なぜ Renovate は default で依存関係を固定化するのか？」が気になったので検索したところ、そのものズバリなページが用意されていた。

[Should you Pin your JavaScript Dependencies?](https://docs.renovatebot.com/dependency-pinning/#so-whats-best)

> Node.js-only libraries can consider pinning all dependencies, because application size/duplicate dependencies are not as much a concern in Node.js compared to the browser. Of course, don't do that if your library is a micro one likely to be consumed in disk-sensitive environments

まぁ確かに、自分が提供することが多い「Dev Dependencies として使って欲しいライブラリ」は大体これに当てはまるなー。

## PicoML

TypeScript 4.3.2 で壊れたところを修正.

```ts
const x = obj[key]; // typeof x = A | B | C ...
if (isXxx(x)) {
  // ここでエラー
  doSomething(x);
}
```

どうも、今までは、`isXxx` の User Defined Type Guard Function を通すだけで問題なかったところが、 `const x = ` の推論結果と `isXxx` の掛け合わせがブロックに伝播するようになって引き起こった問題っぽい。

## Web Standard

@progfay さんが https://github.com/progfay/benefit-from-end-of-ie で面白げなもの作ってた。

```ts
import compatData from "@mdn/browser-compat-data";
import { Identifier } from "@mdn/browser-compat-data/types";
```

ソース見るに、 `@mdn/browser-compat-data` から色々引っこ抜けるのね。すごい。

# 6/2

## Misc

Node 学園が 6/28 にあるみたい。とりあえず申し込み

---

# 6/3

## GraphQL

Netflix の REST -> GraphQL の記事。Falcor はどこにいったのやら。。。

https://netflixtechblog.com/beyond-rest-1b76f7c20ef6

---

# 6/4

## Atomic Design

- https://zenn.dev/takepepe/articles/atomic-redesign
- https://github.com/recruit-tech/eslint-plugin-atomic-redesign

## Lighthouse

https://web.dev/lighthouse-whats-new-6.0/

---

# 6/7

## reg-suit

ただしく shell escape されてない疑惑が浮上。

Node.js の `execSync` のプレースホルダに外部入力文字列が振ってくるのに、sanitize せずに利用してしまっていた。

https://www.npmjs.com/package/shell-escape を使って解消。

## GitHub

Security Advisories を初めて触る。

- とりあえず draft を書く
- private fork で patch 作っておく
- Patch 当てつつ公開する

が王道のフローっぽい。

---

# 6/8

## Safari

Safari 15 のアドレスバー表示位置問題が盛り上がっていた。

https://developer.apple.com/documentation/safari-release-notes/safari-15-beta-release-notes

> Redesigned the Safari user interface in macOS 12, iOS and iPadOS 15, along with adding Tab Groups and customization sync.

リリースノート上だと、いまいちインパクトが分からないが、Twitter で流れていたキャプチャ見た感じ、画面下部に floating でアドレスバーが表示されている模様。今すぐに騒ぐことでもないかな、という気はする。

## WASM

上記の Safari 15 リリースノートに WASM の細かい feature があったので、そういえば Multi Value ってもう Safari でも使えるのかな？と思って試してみたところ、何の問題もなく動いた。
手元の iPad なので、おそらく Safari 14.1。

Modern Browser および Node.js の v.15 以上で利用できる、ということになるので、もう当たり前のものとして使っても良いかも。

## PicoML

少し前に考えていた下記について。

> 今までは「 let が新しい環境を線形メモリ上に用意する」だったが、上記のような出力を実現するためには「 let は新しいローカル変数宣言を予約しつつ、その変数に対して local.set を行う」となる。

> match 式についての考慮があまりできていないが、これは「パターンマッチで適当なメモリに値の組を格納する」 -> 「関数内パラメータとしてのインデックスに合わせてローカルパラメータに展開する」に分解すれば同じレールには乗れそうではある。

現状の match 式のコンパイルは、

```ocaml
match 10::[] with x::y -> x
```

のような式について「パターン `x::y` にマッチすれば、パターンマッチで得られた環境のアドレスを、そうでなければ 0 を」という関数をパターン毎に出力するようにしている。

この matcher 関数について、結果を環境アドレスでなく、環境値とマッチ結果の組にしてしまえば `let` 式で検討していたような「ローカル変数宣言とその値に対する `local.set` 」の形式に載せることができそう。

```wat
(func $main (result i32) (local $x_0 i32) (local $y_1 i32)
  ;; 略

  local.get $value
  call $__matcher_0__
  if (result i32)
    local.set $y_1
    local.set $x_0
    ;; ローカル変数を使った処理
  else
    unreachable
  end
)

(func $__matcher_0__ (param $value i32) (result i32 i32 i32)
  i32.const 10  ;; x に相当する値
  i32.const 0   ;; y に相当する値
  i32.const 1   ;; match 結果 (0 or 1)
)
```
