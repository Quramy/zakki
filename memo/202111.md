# 11/1

## GraphQL

v16 が出てた。Spec としては 2018 以来とあって流石に Breaking Change も多い。。。

https://github.com/graphql/graphql-js/releases/v16.0.0

## Misc

同僚に https://github.com/microsoft/typescript-styled-plugin が僕の ts-graphql-plugin 由来と教わって驚く。

確かに、

> Code originally forked from: https://github.com/Quramy/ts-graphql-plugin

https://github.com/microsoft/typescript-styled-plugin/blob/main/LICENSE.txt にも

```
Copyright (c) base project [2017] [Quramy], Modifications copyright Microsoft 2017
```

とあった。 4 年越しに知るなんて。

---

# 11/2

## Storybook

いつも忘れるんだけど、Storybook における環境変数の件。

環境変数を伝播させるには `STORYBOOK` prefix を付与する必要がある。

```sh
STORYBOOK_HOGE_FUGA=TRUE start-storybook
```

```js
if (process.env.STORYBOOK_HOGE_FUGA === "TRUE") {
  // Something
}
```

ちなみに、JS/TS 以外にも CSS/HTML で直接文字列置換することもできる。

```html
<!-- preview-head.html -->

<base href="%STORYBOOK_BASE_HREF%" />
```

---

# 11/4

## react-query

API 共通で Error Handling を行いたい場合、 `QueryClient` を生成する際に、それぞれの Cache に Error Handler を仕掛けることができる。

```tsx
function App() {
  const queryClient = new QueryClient({
    queryCache: new QueryCache({
      onError: error => {
        // handle error
      }
    }),
    mutationCache: new MutationCache({
      onError: error => {
        // handle error
      }
    })
  });
  return (
    <QueryClientProvider client={queryClient}>
      <MyApp />
    </QueryClientProvider>
  );
}
```

ただ、これって

```ts
const { data, error } = useQuery(/* keyとか */);
```

で error を補足する・しないとは関係なく起こるのだろうし、 Error Boundary と違って、Try Catch のような感覚で使えるような代物じゃないように見えるので使い所が難しそう。

---

# 11/5

## Next.js

社内勉強会で Next.js v12 の Edge Computing まわりの話を聞く。

主に https://www.youtube.com/watch?v=WlP2TB2ORL4 の内容をサマったもの。

自分の中でギモンだった「RSC を Edge で動かすことに何のメリットがあるんだ？」はやはり他の人も思っていたらしい。

## reg

自分のしごとにて、reg-suit をとある prj に突っ込もうとしたところ、 GitHub API Notifier でコケる。

どうも `.git/HEAD` を fs で開こうとするところで ENOTDIR が発生してしまう。ちなみに CI は AWS CodeBuild

どうせ GitHub からの Webhook trigger で動かしているので、その Payload から ref を引っ張り出した方が確実そうだったため、これを行うオプションを用意する。

## Docker

node-xcb が古すぎて、そろそろ諸々の npm package の engines 制約に弾かれるようになってしまっている。

ただ、手元で `docker build` を回すと、 `apt-get install` で bad request が発生して non-zero exit してしまう。

`--no-cache` をつけるなど、いくつかの手立てを試したけどもダメだった。

どうしたものか。。。

---

# 11/8

## JavaScript

そろそろ日付操作系は date-fns とかではなく、 Temporal 使う頃なのかなと思うけど、Polyfill + 型当てってどうやるんだろ。

---

# 11/9

## TypeScript

https://github.com/phenomnomnominal/tsquery を少しだけ触ってみた。

適当に talt から生成した AST 食わせてみたら盛大に Error が出た。最初は、parent 指定していない SourceFile だったからか？と思ったが、factory で生成した AST でも tsquery 側は問題なく動作する。

結論、talt の clone node の処理が完全に誤っていたっぽい。 `forEachChild` など、instance method に相当するものがごっそり欠けていたせいだった。

`new node.constructor()` っていうヤバ味あふれる方法で乗り切ってしまったけど本当にいいんだろうか。。。

## Misc

shopify がなんか出したらしい https://hydrogen.shopify.dev/

---

# 11/10

## Node.js

同僚に教えてもらって初めて知ったのだけど、最新の Node.js では ICU が default で full でサポートされていた。

https://nodejs.org/api/intl.html#options-for-building-nodejs

実は v13 でそうなってたらしい。

確かに下で確認できた。

```sh
docker run --rm -it node:16-slim node -e "x = 1000, console.log(x.toLocaleString('ja-JP'))"
```

---

# 11/11

## react-hook-form

`useFieldArray` 初めて使った

https://react-hook-form.com/api/usefieldarray

## Misc

JSConf JP の登壇者、全然チェックしてなかったけど、知り合い多いな。。。

https://jsconf.jp/2021/schedule/

---

# 11/12

## JavaScript

社内の Slack で「そういえば Decorator Proposal って今どうなってんだっけ？」という話題になった。

https://speakerdeck.com/petamoriken/stage-2-decorators-history?slide=9
